<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoom G2Four Remote</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        button { padding: 20px; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer; background: #333; color: white; transition: 0.3s; }
        button:active { transform: scale(0.95); }
        .fx-btn { border-bottom: 4px solid #555; }
        .fx-on { background: #2ecc71 !important; border-bottom: 4px solid #27ae60; }
        .patch-btn { background: #3498db; border-bottom: 4px solid #2980b9; }
        .status { margin-top: 30px; padding: 10px; background: #222; border-radius: 5px; color: #aaa; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>Zoom G2Four Remote</h1>
    <p>Controlador Web para tu pedalera</p>

    <div class="grid">
        <button id="fx0" class="fx-btn" onclick="sendFX(0)">FX 1</button>
        <button id="fx1" class="fx-btn" onclick="sendFX(1)">FX 2</button>
        <button id="fx2" class="fx-btn" onclick="sendFX(2)">FX 3</button>
        <button id="fx3" class="fx-btn" onclick="sendFX(3)">FX 4</button>
        <button id="fx4" class="fx-btn" onclick="sendFX(4)">FX 5</button>
        <button id="fx5" class="fx-btn" onclick="sendFX(5)">FX 6</button>
    </div>

    <h3 style="margin-top:40px;">Cambio de Parche</h3>
    <div class="grid">
        <button class="patch-btn" onclick="setPatch(0)">P. 1</button>
        <button class="patch-btn" onclick="setPatch(1)">P. 2</button>
        <button class="patch-btn" onclick="setPatch(2)">P. 3</button>
    </div>

    <div class="status" id="log">Esperando conexión MIDI...</div>
</div>

<script>
    let midiOutput = null;
    let fxStates = [false, false, false, false, false, false];

    // Conexión MIDI (El código que te funciona)
    navigator.requestMIDIAccess({ sysex: true }).then(access => {
        const outputs = access.outputs.values();
        for (let output = outputs.next(); output && !output.done; output = outputs.next()) {
            if (output.value.name.includes("G2 Four")) {
                midiOutput = output.value;
                document.getElementById('log').innerText = "Conectado a: " + midiOutput.name;
            }
        }
        if (!midiOutput) document.getElementById('log').innerText = "Pedalera no detectada.";
    });

    function sendFX(slot) {
        if (!midiOutput) return;
        fxStates[slot] = !fxStates[slot];
        let state = fxStates[slot] ? "01" : "00";
        let slotHex = "0" + slot;
        
        // Comando: f0 52 00 6e 64 03 [SLOT] 00 [STATE] 00 00 00 00 00 f7
        let msg = [0xf0, 0x52, 0x00, 0x6e, 0x64, 0x03, slot, 0x00, fxStates[slot] ? 1 : 0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf7];
        midiOutput.send(msg);
        
        document.getElementById('fx' + slot).classList.toggle('fx-on');
    }

    function setPatch(num) {
        if (!midiOutput) return;
        // Comando de cambio de parche: f0 52 00 6e 64 26 00 00 00 00 [NUM] 00 f7
        let msg = [0xf0, 0x52, 0x00, 0x6e, 0x64, 0x26, 0x00, 0x00, 0x00, 0x00, num, 0x00, 0xf7];
        midiOutput.send(msg);
        document.getElementById('log').innerText = "Cambiado a Parche " + (num + 1);
    }
</script>

</body>
</html>
